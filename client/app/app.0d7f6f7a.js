"use strict";angular.module("condominiosmApp",["ngCookies","ngResource","ngSanitize","ui.router","validation.match","pascalprecht.translate"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","$translateProvider","ptBR",function(a,b,c,d,e,f){e.translations("pt-BR",f),e.preferredLanguage("pt-BR"),b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookies","$injector",function(a,b,c,d){var e;return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?((e||(e=d.get("$state"))).go("login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$state","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){d.authenticate&&c.isLoggedIn(function(c){c||(a.preventDefault(),b.go("login"))})})}]),angular.module("condominiosmApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("logout",{url:"/logout?referrer",referrer:"main",template:"",controller:["$state","Auth",function(a,b){var c=a.params.referrer||a.current.referrer||"main";b.logout(),a.go(c)}]}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]).run(["$rootScope",function(a){a.$on("$stateChangeStart",function(a,b,c,d){"logout"===b.name&&d&&d.name&&!d.authenticate&&(b.referrer=d.name)})}]),angular.module("condominiosmApp").controller("LoginCtrl",["$scope","Auth","$state",function(a,b,c){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.go("main")})["catch"](function(b){a.errors.other=b.message})}}]),angular.module("condominiosmApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("condominiosmApp").controller("SignupCtrl",["$scope","Auth","$state",function(a,b,c){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.go("main")})["catch"](function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})}}]),angular.module("condominiosmApp").controller("AdminCtrl",["$scope","$http","Auth","User",function(a,b,c,d){a.users=d.query(),a["delete"]=function(b){d.remove({id:b._id}),a.users.splice(this.$index,1)}}]),angular.module("condominiosmApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("condominiosmApp").controller("MainCtrl",["$scope","$http",function(a,b){a.awesomeThings=[],b.get("/api/things").then(function(b){a.awesomeThings=b.data}),a.addThing=function(){""!==a.newThing&&(b.post("/api/things",{name:a.newThing}),a.newThing="")},a.deleteThing=function(a){b["delete"]("/api/things/"+a._id)}}]),angular.module("condominiosmApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("condominiosmApp").factory("Auth",["$http","User","$cookies","$q",function(a,b,c,d){var e=function(a){return angular.isFunction(a)?a:angular.noop},f={};return c.get("token")&&(f=b.get()),{login:function(g,h){return a.post("/auth/local",{email:g.email,password:g.password}).then(function(a){return c.put("token",a.data.token),f=b.get(),f.$promise}).then(function(a){return e(h)(null,a),a})["catch"](function(a){return this.logout(),e(h)(a.data),d.reject(a.data)}.bind(this))},logout:function(){c.remove("token"),f={}},createUser:function(a,d){return b.save(a,function(g){return c.put("token",g.token),f=b.get(),e(d)(null,a)},function(a){return this.logout(),e(d)(a)}.bind(this)).$promise},changePassword:function(a,c,d){return b.changePassword({id:f._id},{oldPassword:a,newPassword:c},function(){return e(d)(null)},function(a){return e(d)(a)}).$promise},getCurrentUser:function(a){if(0===arguments.length)return f;var b=f.hasOwnProperty("$promise")?f.$promise:f;return d.when(b).then(function(b){return e(a)(b),b},function(){return e(a)({}),{}})},isLoggedIn:function(a){return 0===arguments.length?f.hasOwnProperty("role"):this.getCurrentUser(null).then(function(b){var c=b.hasOwnProperty("role");return e(a)(c),c})},isAdmin:function(a){return 0===arguments.length?"admin"===f.role:this.getCurrentUser(null).then(function(b){var c="admin"===b.role;return e(a)(c),c})},getToken:function(){return c.get("token")}}}]),angular.module("condominiosmApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("condominiosmApp").directive("footer",function(){return{templateUrl:"components/footer/footer.html",restrict:"E",link:function(a,b){b.addClass("footer")}}}),angular.module("condominiosmApp").constant("ptBR",{APARTMENTS:"Apartamentos",CONDOMINIO_SAO_MIGUEL:"Condomínio São Miguel",CONTACT:"Contato",HOME:"Home",LOCALIZATION:"Localização",STRUCTURE:"Estrutura"}),angular.module("condominiosmApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("condominiosmApp").controller("NavbarCtrl",["$scope","Auth","ptBR","$state",function(a,b,c,d){a.menu=[{title:c.HOME,state:"main"},{title:c.STRUCTURE,state:"structure"},{title:c.LOCALIZATION,state:"localization"},{title:c.APARTMENTS,state:"apartments"}],a.isCollapsed=!0,a.isLoggedIn=b.isLoggedIn,a.isAdmin=b.isAdmin,a.getCurrentUser=b.getCurrentUser,a.Title=a.menu[0].title}]),angular.module("condominiosmApp").directive("navbar",function(){return{templateUrl:"components/navbar/navbar.html",restrict:"E",controller:"NavbarCtrl",link:function(a,b,c){b.find(".button-collapse").sideNav()}}}),angular.module("condominiosmApp").controller("OauthButtonsCtrl",["$window",function(a){this.loginOauth=function(b){a.location.href="/auth/"+b}}]),angular.module("condominiosmApp").directive("oauthButtons",function(){return{templateUrl:"components/oauth-buttons/oauth-buttons.html",restrict:"EA",controller:"OauthButtonsCtrl",controllerAs:"OauthButtons",scope:{classes:"@"}}}),angular.module("condominiosmApp").controller("ScrollfireCtrl",["$scope",function(a){a.message="Hello"}]),angular.module("condominiosmApp").directive("scrollfire",function(){return{restrict:"A",controller:"ScrollfireCtrl",link:function(a,b,c){b.text("this is the scrollfire directive")}}}),angular.module("condominiosmApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<navbar></navbar><div class=container><div class=row><div class=col-sm-12><h1>Login</h1><p>Accounts are reset on server restart from<code>server/config/seed.js</code>. Default account is<code>test@example.com</code>/<code>test</code></p><p>Admin account is<code>admin@example.com</code>/<code>admin</code></p></div><div class=col-sm-12><form name=form ng-submit=login(form) novalidate class=form><div class=form-group><label>Email</label><input type=email name=email ng-model=user.email class="form-control"></div><div class=form-group><label>Password</label><input type=password name=password ng-model=user.password class="form-control"></div><div class="form-group has-error"><p ng-show="form.email.$error.required &amp;&amp; form.password.$error.required &amp;&amp; submitted" class=help-block>Please enter your email and password.</p><p class=help-block>{{ errors.other }}</p></div><div><button type=submit class="btn btn-inverse btn-lg btn-login">Login</button> <a ui-sref=signup class="btn btn-default btn-lg btn-register">Register</a></div><hr><div class=row><div class="col-sm-4 col-md-3"><oauth-buttons classes=btn-block></oauth-buttons></div></div></form></div></div><hr></div>'),a.put("app/account/settings/settings.html",'<navbar></navbar><div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form name=form ng-submit=changePassword(form) novalidate class=form><div class=form-group><label>Current Password</label><input type=password name=password ng-model=user.oldPassword mongoose-error="" class="form-control"><p ng-show=form.password.$error.mongoose class=help-block>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword ng-model=user.newPassword ng-minlength=3 required class="form-control"><p ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) &amp;&amp; (form.newPassword.$dirty || submitted)" class=help-block>Password must be at least 3 characters.</p></div><div class=form-group><label>Confirm New Password</label><input type=password name=confirmPassword ng-model=user.confirmPassword match=user.newPassword ng-minlength=3 required class="form-control"><p ng-show="form.confirmPassword.$error.match &amp;&amp; submitted" class=help-block>Passwords must match.</p></div><p class=help-block>{{ message }}</p><button type=submit class="btn btn-lg btn-primary">Save changes</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<navbar></navbar><div class=container><div class=row><div class=col-sm-12><h1>Sign up</h1></div><div class=col-sm-12><form name=form ng-submit=register(form) novalidate class=form><div ng-class="{ &quot;has-success&quot;: form.name.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.name.$invalid &amp;&amp; submitted }" class=form-group><label>Name</label><input name=name ng-model=user.name required class="form-control"><p ng-show="form.name.$error.required &amp;&amp; submitted" class=help-block>A name is required</p></div><div ng-class="{ &quot;has-success&quot;: form.email.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.email.$invalid &amp;&amp; submitted }" class=form-group><label>Email</label><input type=email name=email ng-model=user.email required mongoose-error="" class="form-control"><p ng-show="form.email.$error.email &amp;&amp; submitted" class=help-block>Doesn\'t look like a valid email.</p><p ng-show="form.email.$error.required &amp;&amp; submitted" class=help-block>What\'s your email address?</p><p ng-show=form.email.$error.mongoose class=help-block>{{ errors.email }}</p></div><div ng-class="{ &quot;has-success&quot;: form.password.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.password.$invalid &amp;&amp; submitted }" class=form-group><label>Password</label><input type=password name=password ng-model=user.password mongoose-error="" ng-minlength=3 required class="form-control"><p ng-show="(form.password.$error.minlength || form.password.$error.required) &amp;&amp; submitted" class=help-block>Password must be at least 3 characters.</p><p ng-show=form.password.$error.mongoose class=help-block>{{ errors.password }}</p></div><div ng-class="{ &quot;has-success&quot;: form.confirmPassword.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.confirmPassword.$invalid &amp;&amp; submitted }" class=form-group><label>Confirm Password</label><input type=password name=confirmPassword ng-model=user.confirmPassword match=user.password ng-minlength=3 required class="form-control"><p ng-show="form.confirmPassword.$error.match &amp;&amp; submitted" class=help-block>Passwords must match.</p></div><div><button type=submit class="btn btn-inverse btn-lg btn-register">Sign up</button> <a ui-sref=login class="btn btn-default btn-lg btn-login">Login</a></div><hr><div class=row><div class="col-sm-4 col-md-3"><oauth-buttons classes=btn-block></oauth-buttons></div></div></form></div></div><hr></div>'),a.put("app/admin/admin.html",'<navbar></navbar><div class=container><p>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><ul class=list-group><li ng-repeat="user in users" class=list-group-item><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span><a ng-click=delete(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></li></ul></div>'),a.put("app/main/main.html",'<div class=container><div class=row><div class=col-lg-12><h1 class=page-header>Features:</h1><ul ng-repeat="thing in awesomeThings" class="nav nav-tabs nav-stacked col-md-4 col-lg-4 col-sm-6"><li><a href=# tooltip={{thing.info}}>{{thing.name}}</a></li></ul></div></div></div>'),a.put("components/footer/footer.html",'<div class=container><p>Angular Fullstack v3.0.0-rc7-patch.0 | <a href=https://twitter.com/tyhenkel>@tyhenkel</a> | <a href="https://github.com/DaftMonk/generator-angular-fullstack/issues?state=open">Issues</a></p></div>'),a.put("components/navbar/navbar.html",'<nav class="main-navbar container z-depth-3"><div class="nav-wrapper row"><a href=#! class="brand-logo valign-wrapper waves-light waves-circle"><img src=assets/images/logo-navbar3.28b1c725.png alt="{{ \'CONDOMINIO_SAO_MIGUEL\' | translate }}"></a><a href=# data-activates=left-menu class="button-collapse waves-effect waves-light waves-circle"><i class=mdi-navigation-menu></i></a><ul class="right hide-on-med-and-down right"><li ui-sref-active=active class="animated fadeInDown delay-1"><a ui-sref=main class=md-default-theme>{{ \'HOME\' | translate }}</a></li><li ui-sref-active=active class="animated fadeInDown delay-2"><a ui-sref=structure class=md-default-theme>{{ \'STRUCTURE\' | translate }}</a></li><li ui-sref-active=active class="animated fadeInDown delay-3"><a ui-sref=apartaments class=md-default-theme>{{ \'APARTMENTS\' | translate }}</a></li><li ui-sref-active=active class="animated fadeInDown delay-4"><a ui-sref=localization class=md-default-theme>{{ \'LOCALIZATION\' | translate }}</a></li></ul><ul id=left-menu class=side-nav><li ui-sref-active=active><a ui-sref=main class=md-default-theme>{{ \'HOME\' | translate }}</a></li><li ui-sref-active=active><a ui-sref=structure class=md-default-theme>{{ \'STRUCTURE\' | translate }}</a></li><li ui-sref-active=active><a ui-sref=apartaments class=md-default-theme>{{ \'APARTMENTS\' | translate }}</a></li><li ui-sref-active=active><a ui-sref=localization class=md-default-theme>{{ \'LOCALIZATION\' | translate }}</a></li></ul></div><div class="row title-navbar-row hide-on-med-and-down animated fadeInUp delay-4"><p class=title-navbar>{{ Title }}</p></div></nav>'),a.put("components/oauth-buttons/oauth-buttons.html",'<a ng-class=classes ng-click=OauthButtons.loginOauth(&quot;facebook&quot;) class="btn btn-facebook"><i class="fa fa-facebook"></i> Connect with Facebook</a><a ng-class=classes ng-click=OauthButtons.loginOauth(&quot;google&quot;) class="btn btn-google"><i class="fa fa-google-plus"></i> Connect with Google+</a><a ng-class=classes ng-click=OauthButtons.loginOauth(&quot;twitter&quot;) class="btn btn-twitter"><i class="fa fa-twitter"></i> Connect with Twitter</a>')}]);